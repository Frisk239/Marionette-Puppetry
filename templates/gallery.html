{% extends "base.html" %}

{% block title %}影像资料 - 闽南木偶戏图片视频展示{% endblock %}

{% block content %}
<div class="gallery-container">
    <h1 class="page-title">影像资料</h1>
    <p class="page-subtitle">珍贵的木偶戏表演影像，记录传统艺术的精彩瞬间</p>
    
    <div class="gallery-controls">
        <div class="filter-buttons">
            <button class="filter-btn active" onclick="filterGallery('all')">全部</button>
            <button class="filter-btn" onclick="filterGallery('performance')">表演</button>
            <button class="filter-btn" onclick="filterGallery('craft')">工艺</button>
            <button class="filter-btn" onclick="filterGallery('masters')">大师</button>
            <button class="filter-btn" onclick="filterGallery('stories')">剧目</button>
        </div>
        
        <div class="view-options">
            <button class="view-btn active" onclick="changeView('grid')">网格视图</button>
            <button class="view-btn" onclick="changeView('list')">列表视图</button>
        </div>
    </div>
    
    <div class="gallery-grid" id="galleryGrid">
        <!-- 表演类 -->
        <div class="gallery-item" data-category="performance">
            <div class="item-media">
                <img src="{{ url_for('static', filename='images/performance-1.jpg') }}" alt="传统表演" loading="lazy">
                <div class="item-overlay">
                    <h3>传统庙会表演</h3>
                    <p>闽南传统庙会中的木偶戏表演</p>
                    <button class="view-btn" onclick="openLightbox(this)">查看大图</button>
                </div>
            </div>
            <div class="item-info">
                <h4>传统庙会表演</h4>
                <p>拍摄时间：2023年春节</p>
                <p>地点：泉州开元寺</p>
            </div>
        </div>
        
        <div class="gallery-item" data-category="performance">
            <div class="item-media">
                <video controls poster="{{ url_for('static', filename='images/video-poster-1.jpg') }}">
                    <source src="{{ url_for('static', filename='videos/performance-1.mp4') }}" type="video/mp4">
                    您的浏览器不支持视频播放。
                </video>
                <div class="item-overlay">
                    <h3>现代舞台表演</h3>
                    <p>融合现代元素的木偶戏创新表演</p>
                </div>
            </div>
            <div class="item-info">
                <h4>现代舞台表演</h4>
                <p>拍摄时间：2023年艺术节</p>
                <p>时长：5分30秒</p>
            </div>
        </div>
        
        <!-- 工艺类 -->
        <div class="gallery-item" data-category="craft">
            <div class="item-media">
                <img src="{{ url_for('static', filename='images/craft-1.jpg') }}" alt="木偶制作" loading="lazy">
                <div class="item-overlay">
                    <h3>传统雕刻工艺</h3>
                    <p>木偶头雕刻的精细工艺展示</p>
                    <button class="view-btn" onclick="openLightbox(this)">查看大图</button>
                </div>
            </div>
            <div class="item-info">
                <h4>传统雕刻工艺</h4>
                <p>工艺师：陈师傅</p>
                <p>制作时间：传统工艺</p>
            </div>
        </div>
        
        <div class="gallery-item" data-category="craft">
            <div class="item-media">
                <img src="{{ url_for('static', filename='images/craft-2.jpg') }}" alt="彩绘工艺" loading="lazy">
                <div class="item-overlay">
                    <h3>彩绘工艺</h3>
                    <p>传统彩绘技艺的展示</p>
                    <button class="view-btn" onclick="openLightbox(this)">查看大图</button>
                </div>
            </div>
            <div class="item-info">
                <h4>彩绘工艺</h4>
                <p>颜料：天然矿物颜料</p>
                <p>技法：传统手绘</p>
            </div>
        </div>
        
        <!-- 大师类 -->
        <div class="gallery-item" data-category="masters">
            <div class="item-media">
                <img src="{{ url_for('static', filename='images/master-portrait-1.jpg') }}" alt="李天禄大师" loading="lazy">
                <div class="item-overlay">
                    <h3>李天禄大师</h3>
                    <p>台湾布袋戏国宝级大师</p>
                    <button class="view-btn" onclick="openLightbox(this)">查看大图</button>
                </div>
            </div>
            <div class="item-info">
                <h4>李天禄大师</h4>
                <p>生卒：1910-1998</p>
                <p>成就：布袋戏泰斗</p>
            </div>
        </div>
        
        <div class="gallery-item" data-category="masters">
            <div class="item-media">
                <video controls poster="{{ url_for('static', filename='images/master-video-poster.jpg') }}">
                    <source src="{{ url_for('static', filename='videos/master-interview.mp4') }}" type="video/mp4">
                    您的浏览器不支持视频播放。
                </video>
                <div class="item-overlay">
                    <h3>大师访谈</h3>
                    <p>陈锡煌大师谈木偶戏传承</p>
                </div>
            </div>
            <div class="item-info">
                <h4>大师访谈</h4>
                <p>时长：8分15秒</p>
                <p>内容：传承经验分享</p>
            </div>
        </div>
        
        <!-- 剧目类 -->
        <div class="gallery-item" data-category="stories">
            <div class="item-media">
                <img src="{{ url_for('static', filename='images/story-scene-1.jpg') }}" alt="水浒传场景" loading="lazy">
                <div class="item-overlay">
                    <h3>水浒传场景</h3>
                    <p>武松打虎经典片段</p>
                    <button class="view-btn" onclick="openLightbox(this)">查看大图</button>
                </div>
            </div>
            <div class="item-info">
                <h4>武松打虎</h4>
                <p>剧目：水浒传</p>
                <p>角色：武松</p>
            </div>
        </div>
        
        <div class="gallery-item" data-category="stories">
            <div class="item-media">
                <img src="{{ url_for('static', filename='images/story-scene-2.jpg') }}" alt="三国演义场景" loading="lazy">
                <div class="item-overlay">
                    <h3>三国演义场景</h3>
                    <p>桃园三结义经典片段</p>
                    <button class="view-btn" onclick="openLightbox(this)">查看大图</button>
                </div>
            </div>
            <div class="item-info">
                <h4>桃园三结义</h4>
                <p>剧目：三国演义</p>
                <p>角色：刘备、关羽、张飞</p>
            </div>
        </div>
        
        <div class="gallery-item" data-category="stories">
            <div class="item-media">
                <video controls poster="{{ url_for('static', filename='images/story-video-poster.jpg') }}">
                    <source src="{{ url_for('static', filename='videos/story-performance.mp4') }}" type="video/mp4">
                    您的浏览器不支持视频播放。
                </video>
                <div class="item-overlay">
                    <h3>西游记片段</h3>
                    <p>孙悟空三打白骨精</p>
                </div>
            </div>
            <div class="item-info">
                <h4>三打白骨精</h4>
                <p>剧目：西游记</p>
                <p>时长：12分30秒</p>
            </div>
        </div>
    </div>
    
    <!-- 灯箱效果 -->
    <div id="lightbox" class="lightbox">
        <span class="close-lightbox" onclick="closeLightbox()">&times;</span>
        <img class="lightbox-content" id="lightboxImage">
        <div id="lightboxCaption"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
class GalleryManager {
    constructor() {
        this.currentFilter = 'all';
        this.currentView = 'grid';
        this.items = document.querySelectorAll('.gallery-item');
        this.init();
    }
    
    init() {
        this.setupLazyLoading();
        this.bindEvents();
    }
    
    setupLazyLoading() {
        if ('IntersectionObserver' in window) {
            const imageObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        img.src = img.dataset.src;
                        img.classList.remove('lazy');
                        observer.unobserve(img);
                    }
                });
            });
            
            document.querySelectorAll('img[loading="lazy"]').forEach(img => {
                imageObserver.observe(img);
            });
        }
    }
    
    bindEvents() {
        // 键盘导航
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeLightbox();
            }
        });
    }
    
    filterGallery(category) {
        this.currentFilter = category;
        
        // 更新按钮状态
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        // 过滤项目
        this.items.forEach(item => {
            const itemCategory = item.dataset.category;
            if (category === 'all' || itemCategory === category) {
                item.style.display = 'block';
                item.classList.add('fade-in');
            } else {
                item.style.display = 'none';
            }
        });
    }
    
    changeView(view) {
        this.currentView = view;
        
        // 更新按钮状态
        document.querySelectorAll('.view-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        // 更改视图
        const grid = document.getElementById('galleryGrid');
        grid.className = `gallery-${view}`;
    }
}

// 灯箱功能
function openLightbox(element) {
    const lightbox = document.getElementById('lightbox');
    const lightboxImage = document.getElementById('lightboxImage');
    const lightboxCaption = document.getElementById('lightboxCaption');
    
    const img = element.closest('.item-media').querySelector('img');
    lightboxImage.src = img.src;
    lightboxCaption.innerHTML = img.alt;
    
    lightbox.style.display = 'block';
    document.body.style.overflow = 'hidden';
}

function closeLightbox() {
    const lightbox = document.getElementById('lightbox');
    lightbox.style.display = 'none';
    document.body.style.overflow = 'auto';
}

// 初始化
document.addEventListener('DOMContentLoaded', function() {
    window.gallery = new GalleryManager();
});

// 添加样式
const style = document.createElement('style');
style.textContent = `
    .gallery-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        flex-wrap: wrap;
        gap: 1rem;
    }
    
    .filter-buttons, .view-options {
        display: flex;
        gap: 0.5rem;
    }
    
    .filter-btn, .view-btn {
        padding: 0.5rem 1rem;
        border: 1px solid #ddd;
        background: white;
        cursor: pointer;
        border-radius: 4px;
        transition: all 0.3s ease;
    }
    
    .filter-btn.active, .view-btn.active {
        background: var(--primary-red);
        color: white;
        border-color: var(--primary-red);
    }
    
    .gallery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 2rem;
    }
    
    .gallery-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    
    .gallery-list .gallery-item {
        display: flex;
        gap: 1rem;
    }
    
    .gallery-list .item-media {
        width: 200px;
        height: 150px;
    }
    
    .gallery-item {
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        transition: transform 0.3s ease;
    }
    
    .gallery-item:hover {
        transform: translateY(-5px);
    }
    
    .item-media {
        position: relative;
        overflow: hidden;
        aspect-ratio: 16/9;
    }
    
    .item-media img, .item-media video {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .item-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.7);
        color: white;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .item-media:hover .item-overlay {
        opacity: 1;
    }
    
    .item-info {
        padding: 1rem;
    }
    
    .item-info h4 {
        margin: 0 0 0.5rem 0;
        color: var(--primary-red);
    }
    
    .item-info p {
        margin: 0.25rem 0;
        font-size: 0.9em;
        color: #666;
    }
    
    .lightbox {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.9);
    }
    
    .lightbox-content {
        display: block;
        margin: auto;
        max-width: 90%;
        max-height: 90%;
        margin-top: 5%;
    }
    
    .close-lightbox {
        position: absolute;
        top: 15px;
        right: 35px;
        color: #f1f1f1;
        font-size: 40px;
        font-weight: bold;
        cursor: pointer;
    }
    
    .fade-in {
        animation: fadeIn 0.5s ease-in;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    @media (max-width: 768px) {
        .gallery-controls {
            flex-direction: column;
            align-items: stretch;
        }
        
        .filter-buttons, .view-options {
            justify-content: center;
        }
        
        .gallery-list .gallery-item {
            flex-direction: column;
        }
        
        .gallery-list .item-media {
            width: 100%;
            height: 200px;
        }
    }
`;
document.head.appendChild(style);
</script>
{% endblock %}
